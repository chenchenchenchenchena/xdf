<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>视频</title>
    <link rel="stylesheet" href="../css/core.css" />
    <link rel="stylesheet" href="../css/addInfo.css" />
    <script src="../js/jquery.js"></script>
    <script src="../js/layer-v2.1/layer/layer.js"></script>
</head>
<body>
<div class="startImg"><img src="../images/01.png"  /></div>
<div class="video" style="display:none">
    <video src="" autoplay id="video"></video>
</div>
<script>
    var str = "";
    var playerId = 0;
    createNativeBridge(function (bridge) {
        window.nativeBridge = bridge;
        getVideoDemandPath();
        nativeBridge.attachCloseEventObserver(function () {
            myLog("close event");
            nativeBridge.closeWindow();
        });
    })
    function getVideoDemandPath() {
        var data= new Date().getFullYear()+(new Date().getMonth()+1)+ new Date().getDate();
        nativeBridge.getVideoDemandPath(str, function (args) {
            myLog(JSON.stringify(args));
            if(args.filepath=="-1"){
                layer.msg("路径为空",{icon: 1});
            }else if(args.filepath=="-2"){
                layer.msg("目录不存在",{icon: 1});
            }else if(args.filepath=="0"){
                layer.msg("没有找到匹配的文件",{icon: 1});
            }else{
                $("video").attr("src",args.filepath);
            }

        });
    }
   setInterval(function () {
       /*  str = "";*/
        $.ajax({
            url: "http://dt.staff.xdf.cn/xdfdtmanager/videofile/getPlayInformation.do",
            type: 'get',
            dataType: 'json',
            success:function (e) {
                if(e.result){
                    $(".startImg").hide();
                    $(".video").show();
                    if(e.dataList){
                        $(".box").hide();
                        $(".over").hide();
                        $("#video").show();
                        str="";
                        var dataList = e.dataList;
                        for (var i = 0; i < dataList.length; i++) {
                            var grade = dataList[i]["grade"];
                            var lessonNo = dataList[i]["lessonNo"];
                            var subject = dataList[i]["subject"];
                            var teacherName = dataList[i]["teacherName"];
                            /*var schoolName = dataList[i]["schoolName"];*/
                            var studioNo = dataList[i]["studioNo"];
                            var learningPeriod = dataList[i]["learningPeriod"];
                            var courseName = dataList[i]["courseName"];
                            /* var fileUrl = dataList[i]["fileUrl"];*/

                            str = "直播间" + studioNo + "_" + teacherName + "_" + learningPeriod + "_" + grade + "_" + courseName + "_" + subject + "_" + lessonNo + "讲";

                        }
                        getVideoDemandPath();
                        console.log(str);
                    }else{
                        if($("video").attr("src")==""){
                            $("body,html").css({
                                "background":"#000",
                                "position":'reltive'
                            });
                            $("<div class=box style='position: absolute;left: 50%;top:50%;margin-left: -200px;margin-top: -50px;width: 400px;height: 100px;font-size: 30px;color:#fff;text-align: center'>直播马上开始，请不要走开...</div>").appendTo("body,html");
                        }else{
                            document.getElementById('video').onended = function(){
                                $("#video").hide();
                                $(".box").hide();
                                $("<div class=over style='position: absolute;left: 50%;top:50%;margin-left: -200px;margin-top: -50px;width: 400px;height: 100px;font-size: 30px;color:#fff;text-align: center'>直播已结束...</div>").appendTo("body,html");
                            }
                        }

                    }

                }else{
                    layer.msg(e.message,{icon:1});
                }

            }
        })

     },10000);



    function myLog(log) {
        console.log(log);
    }



</script>
</body>
</html>